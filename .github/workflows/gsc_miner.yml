
name: GSC Keyword Miner (Manual Trigger)

on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'info'

jobs:
  mine-keywords:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Set up GSC credentials
        id: gsc-creds
        run: |
          # Create a temporary file for the credentials
          GSC_KEY_FILE="./gsc_key.json"
          echo "${{ secrets.GSC_CREDENTIALS }}" > $GSC_KEY_FILE
          # Set the file path as an output for the next step
          echo "key_path=$GSC_KEY_FILE" >> $GITHUB_OUTPUT
        env:
          GSC_CREDENTIALS: ${{ secrets.GOOGLE_SEO_JSON }}

      - name: Run GSC Miner Script
        run: python gsc_miner.py
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          GSC_KEY_FILE: ${{ steps.gsc-creds.outputs.key_path }}

